name: Build Wheels

on: [push, pull_request]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install build tools
        run: |
          python -m pip install --upgrade build twine

      - name: Compile binary
        run: |
          gcc src/pyvcon/vcontacts/Vcontacts.c -o src/pyvcon/vcontacts/vcon

      - name: Build wheel
        run: |
          python -m build --wheel

      - name: Rename wheel (optional)
        run: |
          # Rename to include platform tag (example for Linux)
          # You'll customize this per-platform
          mv dist/*.whl dist/$(python scripts/rename_wheel.py dist/*.whl)
          
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          path: dist/*.whl
